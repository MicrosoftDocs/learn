A device enrollment creates a record of a single device or a group of devices that may at some point register with the Device Provisioning Service. The enrollment record contains the initial desired configuration for the device(s) as part of that enrollment, including the desired IoT hub.

## Enrollment types

There are two ways you can enroll your devices with the provisioning service:

* Group enrollments: An enrollment group is a group of devices that share a specific attestation mechanism, typically X.509 certificates. All devices in the X.509 enrollment group present X.509 certificates that have been signed by the same certificate authority (CA).
* Individual enrollments: An individual enrollment is an entry for a single device. We recommend using individual enrollments for devices that require unique initial configurations, or for devices that can only use SAS tokens via TPM or virtual TPM as the attestation mechanism.

When a device connects to the provisioning service, the service prioritizes more specific enrollment entries over less specific enrollment entries. That is, if an individual enrollment for the device exists, the provisioning service applies that entry. If there's no individual enrollment for the device and an enrollment group for the device exists, the service applies that entry.

1. The provisioning service checks for an individual enrollment for the device. If one exists and is enabled, the service provisions that device. If one exists and is disabled, the service doesn't provision the device regardless of any other enrollment lists that may include the device.
1. If no individual enrollment is found, the provisioning service checks for an enrollment group for the device. If one exists and is enabled, the service provisions the device. If one exists and is disabled, the service doesn't provision the device.
1. If no enrollment entry is found, the service doesn't provision the device.

## Attestation mechanism

An attestation mechanism is a method used for confirming a device's identity. The attestation mechanism is also relevant to the enrollment list, which tells the provisioning service which method of attestation to use with a given device.

> [!TIP]
> IoT Hub uses the phrase *authentication type* for a similar concept in that service.

The Device Provisioning Service supports the following forms of attestation:

* **X.509 certificates** based on the standard X.509 certificate authentication flow.
* **Trusted Platform Module (TPM)** based on a nonce challenge, using the TPM standard for keys to present a signed shared access signature (SAS) token. TPM attestation doesn't require a physical TPM on the device, but the service expects to attest using the endorsement key per the TPM spec.
* **Symmetric key** based on shared access signature (SAS) Security tokens, which include a hashed signature and an embedded expiration. For more information, see Symmetric key attestation.

> [!NOTE]
> A hardware security module, or HSM, is recommended for secure, hardware-based storage of device secrets, and is the most secure form of secret storage. Both X.509 certificates and SAS tokens can be stored in HSM.

## Enrollment concepts

The following terms are used frequently when discussing enrollment concepts.

### ID scope

Each instance of DPS has a unique *ID scope* assigned to it that is used to identify the specific provisioning service that a device registers through. The ID scope is generated by the service and is immutable, which guarantees uniqueness. Uniqueness is important for long-running deployment operations and merger and acquisition scenarios.

### Registration ID

A *registration ID* is used to uniquely identify a device in the Device Provisioning Service. The registration ID must be unique in the provisioning service ID scope. Each device must have a registration ID.

* When TPM attestation is used, the registration ID is provided by the TPM itself.
* When X.509-based attestation is used, the registration ID is the subject name of the device certificate.

### Device ID

A *device ID* is how a device appears in IoT Hub. The desired device ID may be set in an individual enrollment entry, but it isn't required. Setting the desired device ID is only supported in individual enrollments. If no desired device ID is specified in the enrollment list, the registration ID is used as the device ID when registering the device.

